<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizar y Seleccionar Tracks - Music Scraper Hub</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="images/icon.PNG">
    <link rel="icon" type="image/png" sizes="16x16" href="images/icon.PNG">
    <link rel="shortcut icon" href="images/icon.PNG">
    <link rel="apple-touch-icon" href="images/icon.PNG">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 50%, #2c2c2c 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            position: relative;
        }

        .background-orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.3;
        }

        .orb-red {
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, #ff4444 0%, #ff0000 50%, transparent 70%);
            top: -200px;
            left: -300px;
            animation: moveOrbRed 25s ease-in-out infinite;
        }

        .orb-blue {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, #44aaff 0%, #0066cc 50%, transparent 70%);
            bottom: -150px;
            right: -250px;
            animation: moveOrbBlue 30s ease-in-out infinite;
        }

        .orb-cyan {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, #00ffdd 0%, #008888 50%, transparent 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: moveOrbCyan 35s ease-in-out infinite;
        }

        @keyframes moveOrbRed {
            0%, 100% { 
                transform: translate(0, 0) scale(1);
            }
            25% { 
                transform: translate(200px, 100px) scale(1.1);
            }
            50% { 
                transform: translate(100px, 300px) scale(0.9);
            }
            75% { 
                transform: translate(-100px, 200px) scale(1.05);
            }
        }

        @keyframes moveOrbBlue {
            0%, 100% { 
                transform: translate(0, 0) scale(1);
            }
            33% { 
                transform: translate(-150px, -100px) scale(1.15);
            }
            66% { 
                transform: translate(-300px, 50px) scale(0.85);
            }
        }

        @keyframes moveOrbCyan {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
            }
            20% { 
                transform: translate(-60%, -40%) scale(1.1);
            }
            40% { 
                transform: translate(-40%, -60%) scale(0.9);
            }
            60% { 
                transform: translate(-55%, -45%) scale(1.05);
            }
            80% { 
                transform: translate(-45%, -55%) scale(0.95);
            }
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            opacity: 0.02;
            background-image: 
                radial-gradient(circle at 25% 25%, #ffffff 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, #ffffff 1px, transparent 1px);
            background-size: 4px 4px;
            animation: noiseMove 8s linear infinite;
        }

        @keyframes noiseMove {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-2px, -2px); }
            50% { transform: translate(2px, 2px); }
            75% { transform: translate(-1px, 1px); }
            100% { transform: translate(0, 0); }
        }

        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        .floating-dot {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 10s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(50px); opacity: 0; }
        }

        /* Navigation Header - Mismo estilo que otras p√°ginas */
        .nav-header {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: linear-gradient(90deg, #181818 80%, #3ad6ff 100%);
            backdrop-filter: blur(20px);
            border-bottom: none;
            padding: 0.7rem 0;
            border-radius: 2.5rem;
            margin-top: 1.2rem;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            transition: box-shadow 0.2s, background 0.2s;
            max-width: 900px;
            width: 90vw;
        }

        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-logo-icon {
            width: 54px;
            height: 54px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 2.2rem;
            color: #111;
            box-shadow: 0 4px 16px rgba(0,0,0,0.13);
            border: 2px solid #222;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1.7rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            color: #ffffff;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 400;
            text-transform: capitalize;
            letter-spacing: 0.02em;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover {
            color: #ff4444;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #ff4444, #ff0000);
            transition: width 0.3s ease;
        }

        .nav-link.active {
            color: #667eea;
        }

        .nav-link.active::after {
            width: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1.2rem;
        }

        .nav-external-link {
            color: #ffffff;
            text-decoration: none;
            font-size: 0.9rem;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .nav-external-link:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .nav-listen-btn {
            background: #ff1744;
            color: #fff;
            border: none;
            border-radius: 2rem;
            padding: 0.85rem 2.5rem;
            font-size: 1.15rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(255,23,68,0.13);
            display: flex;
            align-items: center;
            gap: 0.7rem;
            transition: background 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .nav-listen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.4);
        }

        .nav-mobile-toggle {
            display: none;
            background: none;
            border: none;
            color: #ffffff;
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .nav-header {
                padding: 0.4rem 0;
                margin-top: 0.7rem;
                border-radius: 1.2rem;
                max-width: 98vw;
            }
            .nav-container {
                max-width: 98vw;
                padding: 0 10px;
            }
            .nav-logo-icon {
                width: 44px;
                height: 44px;
                font-size: 1.5rem;
            }
            .nav-menu {
                display: none;
            }
            .nav-mobile-toggle {
                display: block;
            }
            .nav-actions {
                gap: 10px;
            }
            .nav-listen-btn {
                padding: 0.5rem 1.2rem;
                font-size: 1rem;
            }
            .nav-external-link {
                display: none;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 120px 20px 20px; /* Espacio para el nav header */
            position: relative;
            z-index: 3;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .page-header h1 {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(180deg, #ffffff 0%, #888888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .page-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
            color: #aaaaaa;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 0;
            padding: 40px;
            margin-bottom: 25px;
            text-align: center;
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            color: #ffffff;
            position: relative;
            overflow: hidden;
        }

        .upload-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ffffff, transparent);
            transition: left 0.8s ease;
        }

        .upload-section:hover::before {
            left: 100%;
        }

        .upload-section:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .upload-section.dragover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.02);
        }

        .upload-label {
            display: inline-block;
            padding: 15px 40px;
            background: transparent;
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.4s ease;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            position: relative;
            overflow: hidden;
        }

        .upload-label::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: #ffffff;
            transition: left 0.4s ease;
            z-index: -1;
        }

        .upload-label:hover::before {
            left: 0;
        }

        .upload-label:hover {
            color: #000000;
            border-color: #ffffff;
        }

        .upload-info {
            color: #aaaaaa;
            font-size: 14px;
            margin-top: 15px;
            font-weight: 300;
        }

        .file-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .file-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 0;
            cursor: pointer;
            transition: all 0.4s ease;
            color: white;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            overflow: hidden;
        }

        .file-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transition: left 0.4s ease;
            z-index: -1;
        }

        .file-tab:hover::before {
            left: 0;
        }

        .file-tab.active {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .file-tab:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 0;
            padding: 30px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .controls-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ffffff, transparent);
            transition: left 0.8s ease;
        }

        .controls-panel:hover::before {
            left: 100%;
        }

        .file-selector {
            margin-bottom: 20px;
        }

        .file-selector label {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .file-selector select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .file-selector select:focus {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }

        .file-selector option {
            background: #2c2c2c;
            color: #ffffff;
        }

        .actions-bar {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .btn {
            padding: 12px 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.4s ease;
            font-size: 14px;
            background: transparent;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: #ffffff;
            transition: left 0.4s ease;
            z-index: -1;
        }

        .btn:hover::before {
            left: 0;
        }

        .btn:hover {
            color: #000000;
            border-color: #ffffff;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .btn:disabled:hover {
            color: #ffffff;
            background: transparent;
        }

        .btn:disabled::before {
            display: none;
        }

        .selection-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            color: #aaaaaa;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .tracks-table-container {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 0;
            padding: 0;
            overflow: hidden;
            position: relative;
        }

        .tracks-table-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ffffff, transparent);
            transition: left 0.8s ease;
        }

        .tracks-table-container:hover::before {
            left: 100%;
        }

        .tracks-table {
            width: 100%;
            border-collapse: collapse;
            background: transparent;
        }

        .tracks-table th {
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .tracks-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            vertical-align: middle;
            background: transparent;
        }

        .tracks-table tr {
            transition: all 0.3s ease;
        }

        .tracks-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .tracks-table tr.selected {
            background: rgba(255, 255, 255, 0.08) !important;
        }

        .checkbox-cell {
            width: 40px;
            text-align: center;
        }

        .track-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #ffffff;
        }

        .position-cell {
            width: 60px;
            font-weight: 600;
            color: #aaaaaa;
        }

        .track-info {
            min-width: 300px;
        }

        .track-title {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .track-artist {
            color: #aaaaaa;
            font-size: 14px;
        }

        .play-buttons {
            display: flex;
            gap: 8px;
        }

        .play-btn {
            padding: 6px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: transparent;
            color: #ffffff;
            position: relative;
            overflow: hidden;
        }

        .play-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            transition: left 0.3s ease;
            z-index: -1;
        }

        .play-btn.youtube::before {
            background: #ff0000;
        }

        .play-btn.soundcloud::before {
            background: #ff6600;
        }

        .play-btn:hover::before {
            left: 0;
        }

        .play-btn:hover {
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.4);
        }

        .genre-badge {
            padding: 4px 8px;
            border-radius: 0;
            font-size: 12px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #aaaaaa;
        }

        .loading .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #aaaaaa;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-weight: 300;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 0;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: rgba(0, 150, 0, 0.9);
            border-color: rgba(0, 255, 0, 0.3);
        }

        .toast.error {
            background: rgba(150, 0, 0, 0.9);
            border-color: rgba(255, 0, 0, 0.3);
        }

        .upload-input {
            display: none;
        }

        /* Reproductor Integrado de YouTube */
        .music-player-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .music-player-container {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0;
            padding: 30px;
            max-width: 900px;
            width: 90vw;
            max-height: 80vh;
            position: relative;
            overflow: hidden;
        }

        .music-player-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ffffff, transparent);
            transition: left 0.8s ease;
        }

        .music-player-container:hover::before {
            left: 100%;
        }

        .music-player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .music-player-title {
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .music-player-subtitle {
            color: #aaaaaa;
            font-size: 0.9rem;
            font-weight: 300;
            margin-top: 5px;
        }

        .music-player-close {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            width: 40px;
            height: 40px;
            border-radius: 0;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .music-player-close::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: #ff4444;
            transition: left 0.3s ease;
            z-index: -1;
        }

        .music-player-close:hover::before {
            left: 0;
        }

        .music-player-close:hover {
            color: #ffffff;
            border-color: #ff4444;
        }

        .music-player-content {
            position: relative;
        }

        .music-player-iframe {
            width: 100%;
            height: 450px;
            border: none;
            border-radius: 0;
            background: #000;
        }

        .music-player-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .music-player-info {
            flex: 1;
        }

        .music-player-track {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .music-player-artist {
            color: #aaaaaa;
            font-size: 0.9rem;
        }

        .music-player-buttons {
            display: flex;
            gap: 10px;
        }

        .music-player-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .music-player-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: #ffffff;
            transition: left 0.3s ease;
            z-index: -1;
        }

        .music-player-btn:hover::before {
            left: 0;
        }

        .music-player-btn:hover {
            color: #000000;
            border-color: #ffffff;
        }

        .music-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #ffffff;
        }

        .music-loading .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .actions-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .tracks-table {
                font-size: 14px;
            }

            .tracks-table th,
            .tracks-table td {
                padding: 8px 6px;
            }

            .track-info {
                min-width: 200px;
            }

            .play-buttons {
                flex-direction: column;
                gap: 4px;
            }

            /* Reproductor m√≥vil */
            .music-player-container {
                width: 95vw;
                padding: 20px;
                max-height: 90vh;
            }

            .music-player-iframe {
                height: 250px;
            }

            .music-player-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .music-player-title {
                font-size: 1rem;
            }

            .music-player-subtitle {
                font-size: 0.8rem;
            }

            .music-player-controls {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .music-player-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Background Elements -->
    <div class="background-orbs">
        <div class="orb orb-red"></div>
        <div class="orb orb-blue"></div>
        <div class="orb orb-cyan"></div>
    </div>
    <div class="noise-overlay"></div>
    <div class="floating-elements" id="floatingElements"></div>

    <!-- Navigation Header -->
    <nav class="nav-header">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="./images/icon.PNG" alt="Logo" class="nav-logo-icon" style="width:54px;height:54px;border-radius:50%;object-fit:cover;border:2px solid #222;box-shadow:0 4px 16px rgba(0,0,0,0.13);">
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Inicio</a>
                </li>
                <li class="nav-item">
                    <a href="beatport.html" class="nav-link">Beatport</a>
                </li>
                <li class="nav-item">
                    <a href="traxsource.html" class="nav-link">Traxsource</a>
                </li>
                <li class="nav-item">
                    <a href="1001tracklists.html" class="nav-link">1001Tracklists</a>
                </li>
                <li class="nav-item">
                    <a href="visualiceList.html" class="nav-link active">Visualice</a>
                </li>
                <li class="nav-item">
                    <a href="radio.html" class="nav-link">Radio</a>
                </li>
            </ul>
            
            <div class="nav-actions">
                <a href="index.html" class="nav-external-link">üè†</a>
                <a href="radio.html" class="nav-listen-btn"><span class="visually-hidden">Listen</span></a>
            </div>
            
            <button class="nav-mobile-toggle">‚ò∞</button>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>üéµ Visualizar y Seleccionar Tracks</h1>
            <p>Sube tu archivo CSV o selecciona uno descargado previamente</p>
        </div>

        <!-- Secci√≥n de carga de archivos -->
        <div class="upload-section" id="uploadSection">
            <div class="upload-content">
                <h3>üìÅ Cargar archivo CSV</h3>
                <input type="file" id="csvFileInput" class="upload-input" accept=".csv" />
                <label for="csvFileInput" class="upload-label">
                    üì§ Seleccionar archivo CSV
                </label>
                <div class="upload-info">
                    Arrastra y suelta un archivo CSV aqu√≠ o haz clic para seleccionar
                    <br>Formatos soportados: .csv (m√°ximo 10MB)
                </div>
            </div>
        </div>

        <!-- Tabs para alternar entre archivo cargado y archivos del servidor -->
        <div class="file-tabs">
            <div class="file-tab active" id="uploadedTab" data-source="uploaded">
                üìÅ Archivo Cargado
            </div>
            <div class="file-tab" id="serverTab" data-source="server">
                üíæ Archivos del Servidor
            </div>
        </div>

        <div class="controls-panel">
            <!-- Selector de archivos del servidor (oculto inicialmente) -->
            <div class="file-selector" id="serverFileSelector" style="display: none;">
                <label for="csvFileSelect">Seleccionar archivo CSV del servidor:</label>
                <select id="csvFileSelect">
                    <option value="">-- Selecciona un archivo CSV --</option>
                </select>
            </div>

            <div class="actions-bar">
                <div class="selection-info">
                    <span id="selectionCount">0 canciones seleccionadas</span>
                </div>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="selectAllBtn">
                        <span id="selectAllText">Seleccionar Todo</span>
                    </button>
                    <button class="btn btn-warning" id="clearSelectionBtn" disabled>
                        Limpiar Selecci√≥n
                    </button>
                    <button class="btn btn-success" id="downloadSelectedBtn" disabled>
                        üíæ Descargar Seleccionadas
                    </button>
                </div>
            </div>
        </div>

        <div class="tracks-table-container">
            <div id="loadingState" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Cargando tracks...</p>
            </div>

            <div id="emptyState" class="empty-state">
                <div class="icon">üìÇ</div>
                <h3>No hay archivo seleccionado</h3>
                <p>Selecciona un archivo CSV para comenzar a visualizar y seleccionar tracks</p>
            </div>

            <div id="tableContainer" style="display: none;">
                <table class="tracks-table">
                    <thead>
                        <tr>
                            <th class="checkbox-cell">
                                <input type="checkbox" id="selectAllCheckbox" class="track-checkbox">
                            </th>
                            <th class="position-cell">#</th>
                            <th class="track-info">Track</th>
                            <th>G√©nero</th>
                            <th>BPM</th>
                            <th>Label</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tracksTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <!-- Reproductor Integrado de YouTube -->
    <div id="musicPlayerOverlay" class="music-player-overlay">
        <div class="music-player-container">
            <div class="music-player-header">
                <div>
                    <h3 class="music-player-title" id="playerTrackTitle">Reproduciendo</h3>
                    <p class="music-player-subtitle" id="playerTrackArtist">Artista</p>
                </div>
                <button class="music-player-close" onclick="trackVisualizer.closeMusicPlayer()">‚úï</button>
            </div>
            <div class="music-player-content">
                <div id="musicLoading" class="music-loading">
                    <div class="spinner"></div>
                    <p>Buscando canci√≥n...</p>
                </div>
                <iframe id="musicPlayerIframe" class="music-player-iframe" style="display: none;" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div class="music-player-controls">
                <div class="music-player-info">
                    <div class="music-player-track" id="playerTrackTitleBottom">Track</div>
                    <div class="music-player-artist" id="playerTrackArtistBottom">Artist</div>
                </div>
                <div class="music-player-buttons">
                    <button class="music-player-btn" onclick="trackVisualizer.searchYouTube()" title="Buscar en YouTube">
                        üîç Buscar
                    </button>
                    <button class="music-player-btn" onclick="trackVisualizer.closeMusicPlayer()" title="Cerrar reproductor">
                        ‚úï Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Player Persistente -->
    <div id="radioPlayerFooter" style="display:none;"></div>
    <audio id="footerAudio" style="display:none;" preload="none"></audio>

    <script>
        // Footer player persistente - Mismo c√≥digo que otras p√°ginas
        const footer = document.getElementById('radioPlayerFooter');
        const audio = document.getElementById('footerAudio');
        let currentRadioName = '';
        
        function showFooterPlayer(url, name) {
            currentRadioName = name;
            audio.src = url;
            audio.loop = true;
            audio.autoplay = true;
            audio.style.display = 'none';
            audio.play();
            localStorage.setItem('radio_stream_url', url);
            localStorage.setItem('radio_stream_name', name);
            renderFooterPlayer();
        }
        
        function renderFooterPlayer() {
            footer.style.display = 'flex';
            footer.style.position = 'fixed';
            footer.style.left = '0';
            footer.style.right = '0';
            footer.style.bottom = '0';
            footer.style.height = '90px';
            footer.style.background = 'linear-gradient(90deg, #111 70%, #00353d 100%)';
            footer.style.color = '#fff';
            footer.style.zIndex = '9999';
            footer.style.alignItems = 'center';
            footer.style.justifyContent = 'space-between';
            footer.style.padding = '0 40px';
            footer.style.boxShadow = '0 -2px 16px rgba(0,0,0,0.25)';
            footer.innerHTML = `
                <div style="display:flex;align-items:center;gap:16px;">
                    <svg width="48" height="48" viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg" style="border-radius:12px;object-fit:cover;">
                        <path d="M199.641 113.351C198.353 117.933 193.96 120.61 189.337 119.393C183.956 117.976 179.319 118.749 175.67 123.245C173.924 125.393 173.18 127.87 173.194 130.633C173.208 147.715 173.237 164.811 173.151 181.893C173.151 183.726 172.808 185.745 172.021 187.363C170.174 191.1 165.953 192.803 162.06 191.773C158.396 190.799 155.649 187.191 155.62 183.11C155.591 178.557 155.591 173.989 155.591 169.436C155.591 164.883 155.591 160.315 155.591 155.762C155.591 147.343 155.563 138.924 155.591 130.504C155.663 114.081 168.829 100.908 185.044 101.166C188.035 101.209 191.083 101.853 193.974 102.655C198.597 103.944 200.944 108.64 199.613 113.337L199.641 113.351ZM132.922 189.009C130.418 191.787 127.312 192.689 123.806 191.558C120.171 190.384 118.11 187.735 117.624 183.912C117.552 183.353 117.567 182.781 117.567 182.208C117.567 145.997 117.567 109.786 117.567 73.5746C117.567 67.8902 121.273 63.8524 126.454 63.8524C130.833 63.8524 134.583 67.2315 135.055 71.6273C135.141 72.4434 135.141 73.2739 135.141 74.09C135.141 92.0739 135.141 110.043 135.141 128.027C135.141 146.068 135.141 164.109 135.141 182.165C135.141 184.714 134.668 187.062 132.908 189.023L132.922 189.009ZM96.6865 183.21C96.6865 187.62 93.6239 191.372 89.7027 191.901C85.0515 192.531 81.0587 190.069 79.8566 185.773C79.5846 184.814 79.556 183.769 79.556 182.766C79.5417 170.538 79.556 158.325 79.556 146.097C79.556 133.869 79.556 121.899 79.556 109.814C79.556 104.559 83.1768 100.751 88.1714 100.751C93.1373 100.751 96.7008 104.459 96.7008 109.685C96.7008 114.912 96.7008 183.21 96.7008 183.21H96.6865ZM128.071 0.00688847C60.2645 -0.709029 0.0859603 54.4596 9.31497e-05 127.827C-0.085774 200.378 59.2055 256.849 129.531 255.99C198.954 255.131 254.51 199.118 255.97 130.819C257.53 57.4521 197.809 -0.608801 128.071 0.00688847Z" fill="currentColor"></path>
                    </svg>
                    <div>
                        <div style="font-size:1.1rem;font-weight:600;">${currentRadioName}</div>
                        <div style="font-size:0.9rem;color:#ccc;">En reproducci√≥n</div>
                    </div>
                </div>
                <div style="flex:1;text-align:center;">
                    <button id="footerPlayPause" style="background:#222;border:none;border-radius:50%;width:48px;height:48px;color:#fff;font-size:1.5rem;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.18);">
                        <img id="footerPlayPauseIcon" src="https://cdn.prod.website-files.com/650d9b67d864656415c17b80/65699589050a0d478f24591d_play.png" alt="Play/Pause" style="width:18px;height:18px;object-fit:contain;filter:brightness(1.2);">
                    </button>
                </div>
                <div style="width:120px;text-align:right;">
                    <button id="footerClose" style="background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;">‚úñ</button>
                </div>
            `;
        
            const playIcon = 'https://cdn.prod.website-files.com/650d9b67d864656415c17b80/65699589050a0d478f24591d_play.png';
            const pauseIcon = 'https://cdn.prod.website-files.com/650d9b67d864656415c17b80/65699589050a0d478f245914_pause-button.png';
            const playPauseImg = document.getElementById('footerPlayPauseIcon');
            
            function updatePlayPauseIcon() {
                playPauseImg.src = audio.paused ? playIcon : pauseIcon;
            }
            
            document.getElementById('footerPlayPause').onclick = function() {
                if (audio.paused) {
                    audio.play();
                } else {
                    audio.pause();
                }
                updatePlayPauseIcon();
            };
            
            audio.addEventListener('play', updatePlayPauseIcon);
            audio.addEventListener('pause', updatePlayPauseIcon);
            updatePlayPauseIcon();
            
            document.getElementById('footerClose').onclick = function() {
                audio.pause();
                footer.style.display = 'none';
                localStorage.removeItem('radio_stream_url');
                localStorage.removeItem('radio_stream_name');
            };
        }
        
        // Persistencia al navegar
        window.addEventListener('DOMContentLoaded', () => {
            const url = localStorage.getItem('radio_stream_url');
            const name = localStorage.getItem('radio_stream_name');
            if (url && name) {
                showFooterPlayer(url, name);
            }
        });

        class TrackVisualizer {
            constructor() {
                this.tracks = [];
                this.selectedTracks = new Set();
                this.currentFile = null;
                this.currentSource = 'uploaded'; // 'uploaded' or 'server'
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadAvailableFiles();
                this.setupDragAndDrop();
            }

            bindEvents() {
                // Event listeners para tabs
                document.querySelectorAll('.file-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        this.switchSource(tab.dataset.source);
                    });
                });

                // Event listener para archivo local
                document.getElementById('csvFileInput').addEventListener('change', (e) => {
                    if (e.target.files[0]) {
                        this.loadLocalCSVFile(e.target.files[0]);
                    }
                });

                // Event listener para archivos del servidor
                document.getElementById('csvFileSelect').addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.loadCSVFile(e.target.value);
                    } else {
                        this.showEmptyState();
                    }
                });

                document.getElementById('selectAllBtn').addEventListener('click', () => {
                    this.toggleSelectAll();
                });

                document.getElementById('clearSelectionBtn').addEventListener('click', () => {
                    this.clearSelection();
                });

                document.getElementById('downloadSelectedBtn').addEventListener('click', () => {
                    this.downloadSelected();
                });

                document.getElementById('selectAllCheckbox').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        this.selectAll();
                    } else {
                        this.clearSelection();
                    }
                });
            }

            setupDragAndDrop() {
                const uploadSection = document.getElementById('uploadSection');
                
                uploadSection.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadSection.classList.add('dragover');
                });

                uploadSection.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('dragover');
                });

                uploadSection.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0 && files[0].name.endsWith('.csv')) {
                        this.switchSource('uploaded');
                        this.loadLocalCSVFile(files[0]);
                    } else {
                        this.showToast('Por favor, sube un archivo CSV v√°lido', 'error');
                    }
                });
            }

            switchSource(source) {
                this.currentSource = source;
                
                // Actualizar tabs activos
                document.querySelectorAll('.file-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.source === source);
                });

                // Mostrar/ocultar selectores
                const serverSelector = document.getElementById('serverFileSelector');
                const uploadSection = document.getElementById('uploadSection');
                
                if (source === 'server') {
                    serverSelector.style.display = 'block';
                    uploadSection.style.display = 'none';
                    if (document.getElementById('csvFileSelect').value) {
                        this.loadCSVFile(document.getElementById('csvFileSelect').value);
                    } else {
                        this.showEmptyState();
                    }
                } else {
                    serverSelector.style.display = 'none';
                    uploadSection.style.display = 'block';
                    if (!this.tracks.length) {
                        this.showEmptyState();
                    }
                }
            }

            async loadLocalCSVFile(file) {
                this.showLoading();
                
                try {
                    // Verificar tama√±o del archivo (m√°ximo 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        throw new Error('El archivo es demasiado grande. M√°ximo 10MB permitido.');
                    }

                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        try {
                            const csvText = e.target.result;
                            this.parseCSV(csvText);
                            this.currentFile = `local:${file.name}`;
                            this.renderTracks();
                            this.showToast(`Archivo "${file.name}" cargado exitosamente`, 'success');
                        } catch (error) {
                            console.error('Error parsing CSV:', error);
                            this.showToast('Error procesando el archivo CSV', 'error');
                            this.showEmptyState();
                        }
                    };

                    reader.onerror = () => {
                        this.showToast('Error leyendo el archivo', 'error');
                        this.showEmptyState();
                    };

                    reader.readAsText(file, 'utf-8');

                } catch (error) {
                    console.error('Error loading local CSV:', error);
                    this.showToast(error.message || 'Error cargando el archivo', 'error');
                    this.showEmptyState();
                }
            }

            async loadAvailableFiles() {
                try {
                    // Cargar archivos de todos los scrapers
                    const [beatportFiles, traxsourceFiles, tracklistsFiles] = await Promise.all([
                        fetch('/api/beatport/files').then(r => r.ok ? r.json() : { files: [] }),
                        fetch('/api/traxsource/files').then(r => r.ok ? r.json() : { files: [] }),
                        fetch('/api/1001tracklists/files').then(r => r.ok ? r.json() : { files: [] })
                    ]);

                    const select = document.getElementById('csvFileSelect');
                    select.innerHTML = '<option value="">-- Selecciona un archivo CSV --</option>';

                    // Agregar archivos de Beatport
                    if (beatportFiles.files && beatportFiles.files.length > 0) {
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = 'üéß Beatport';
                        beatportFiles.files.forEach(file => {
                            const option = document.createElement('option');
                            option.value = `beatport:${file.filename}`;
                            option.textContent = file.filename;
                            optgroup.appendChild(option);
                        });
                        select.appendChild(optgroup);
                    }

                    // Agregar archivos de Traxsource
                    if (traxsourceFiles.files && traxsourceFiles.files.length > 0) {
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = 'üè† Traxsource';
                        traxsourceFiles.files.forEach(file => {
                            const option = document.createElement('option');
                            option.value = `traxsource:${file.filename}`;
                            option.textContent = file.filename;
                            optgroup.appendChild(option);
                        });
                        select.appendChild(optgroup);
                    }

                    // Agregar archivos de 1001Tracklists
                    if (tracklistsFiles.files && tracklistsFiles.files.length > 0) {
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = 'üìù 1001Tracklists';
                        tracklistsFiles.files.forEach(file => {
                            const option = document.createElement('option');
                            option.value = `1001tracklists:${file.filename}`;
                            option.textContent = file.filename;
                            optgroup.appendChild(option);
                        });
                        select.appendChild(optgroup);
                    }

                } catch (error) {
                    console.error('Error loading files:', error);
                    this.showToast('Error cargando archivos disponibles', 'error');
                }
            }

            async loadCSVFile(fileIdentifier) {
                this.showLoading();
                
                try {
                    const [platform, filename] = fileIdentifier.split(':');
                    const response = await fetch(`/api/${platform}/download/${filename}`);
                    
                    if (!response.ok) {
                        throw new Error('Error cargando archivo');
                    }

                    const csvText = await response.text();
                    this.parseCSV(csvText);
                    this.currentFile = fileIdentifier;
                    this.renderTracks();
                    this.showToast('Archivo cargado exitosamente', 'success');

                } catch (error) {
                    console.error('Error loading CSV:', error);
                    this.showToast('Error cargando el archivo CSV', 'error');
                    this.showEmptyState();
                }
            }

            parseCSV(csvText) {
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
                
                this.tracks = lines.slice(1).map((line, index) => {
                    const values = this.parseCSVLine(line);
                    const track = {};
                    
                    headers.forEach((header, i) => {
                        track[header] = values[i] || '';
                    });

                    // Crear un ID √∫nico para cada track
                    track.id = `track_${index}`;
                    
                    return track;
                }).filter(track => track.T√≠tulo || track.Title || track['Track Title'] || track.title);
            }

            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim().replace(/^"(.*)"$/, '$1'));
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim().replace(/^"(.*)"$/, '$1'));
                return result;
            }

            renderTracks() {
                const tbody = document.getElementById('tracksTableBody');
                tbody.innerHTML = '';

                this.tracks.forEach((track, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = this.createTrackRowHTML(track, index + 1);
                    tbody.appendChild(row);
                });

                this.showTable();
                this.updateSelectionInfo();
            }

            createTrackRowHTML(track, position) {
                const title = track.T√≠tulo || track.Title || track['Track Title'] || track.title || 'Sin t√≠tulo';
                const artist = track.Artista || track.Artist || track['Artist Name'] || track.artist || 'Artista desconocido';
                const genre = track.G√©nero || track.Genre || track.genre || 'N/A';
                const bpm = track.BPM || track.bpm || 'N/A';
                const label = track.Label || track.label || track['Record Label'] || 'N/A';
                
                const searchQuery = encodeURIComponent(`${title} ${artist}`);
                const youtubeUrl = `https://www.youtube.com/results?search_query=${searchQuery}`;
                const soundcloudUrl = `https://soundcloud.com/search?q=${searchQuery}`;

                return `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="track-checkbox" data-track-id="${track.id}" 
                               onchange="trackVisualizer.toggleTrackSelection('${track.id}')">
                    </td>
                    <td class="position-cell">${position}</td>
                    <td class="track-info">
                        <div class="track-title">${this.escapeHtml(title)}</div>
                        <div class="track-artist">${this.escapeHtml(artist)}</div>
                    </td>
                    <td>
                        <span class="genre-badge">${this.escapeHtml(genre)}</span>
                    </td>
                    <td>${this.escapeHtml(bpm)}</td>
                    <td>${this.escapeHtml(label)}</td>
                    <td>
                        <div class="play-buttons">
                            <button class="play-btn youtube" onclick="trackVisualizer.playTrack('${this.escapeHtml(title)}', '${this.escapeHtml(artist)}')" 
                                    title="Reproducir en reproductor integrado">
                                ‚ñ∂Ô∏è Reproducir
                            </button>
                            <button class="play-btn youtube" onclick="window.open('${youtubeUrl}', '_blank')" 
                                    title="Buscar en YouTube">
                                üì∫ YouTube
                            </button>
                            <button class="play-btn soundcloud" onclick="window.open('${soundcloudUrl}', '_blank')" 
                                    title="Buscar en SoundCloud">
                                üéµ SoundCloud
                            </button>
                        </div>
                    </td>
                `;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            toggleTrackSelection(trackId) {
                const checkbox = document.querySelector(`input[data-track-id="${trackId}"]`);
                const row = checkbox.closest('tr');
                
                if (checkbox.checked) {
                    this.selectedTracks.add(trackId);
                    row.classList.add('selected');
                } else {
                    this.selectedTracks.delete(trackId);
                    row.classList.remove('selected');
                }
                
                this.updateSelectionInfo();
                this.updateSelectAllState();
            }

            selectAll() {
                this.tracks.forEach(track => {
                    this.selectedTracks.add(track.id);
                    const checkbox = document.querySelector(`input[data-track-id="${track.id}"]`);
                    const row = checkbox.closest('tr');
                    checkbox.checked = true;
                    row.classList.add('selected');
                });
                
                this.updateSelectionInfo();
                this.updateSelectAllState();
            }

            clearSelection() {
                this.selectedTracks.clear();
                document.querySelectorAll('.track-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.closest('tr').classList.remove('selected');
                });
                
                this.updateSelectionInfo();
                this.updateSelectAllState();
            }

            toggleSelectAll() {
                if (this.selectedTracks.size === this.tracks.length) {
                    this.clearSelection();
                } else {
                    this.selectAll();
                }
            }

            updateSelectAllState() {
                const selectAllCheckbox = document.getElementById('selectAllCheckbox');
                const selectAllText = document.getElementById('selectAllText');
                
                if (this.selectedTracks.size === 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                    selectAllText.textContent = 'Seleccionar Todo';
                } else if (this.selectedTracks.size === this.tracks.length) {
                    selectAllCheckbox.checked = true;
                    selectAllCheckbox.indeterminate = false;
                    selectAllText.textContent = 'Deseleccionar Todo';
                } else {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = true;
                    selectAllText.textContent = 'Seleccionar Todo';
                }
            }

            updateSelectionInfo() {
                const count = this.selectedTracks.size;
                document.getElementById('selectionCount').textContent = 
                    `${count} ${count === 1 ? 'canci√≥n seleccionada' : 'canciones seleccionadas'}`;
                
                document.getElementById('clearSelectionBtn').disabled = count === 0;
                document.getElementById('downloadSelectedBtn').disabled = count === 0;
            }

            async downloadSelected() {
                if (this.selectedTracks.size === 0) {
                    this.showToast('No hay canciones seleccionadas', 'error');
                    return;
                }

                try {
                    const selectedTracksData = this.tracks.filter(track => 
                        this.selectedTracks.has(track.id)
                    );

                    // Crear CSV con tracks seleccionados
                    const headers = Object.keys(selectedTracksData[0]).filter(key => key !== 'id');
                    const csvContent = [
                        headers.join(','),
                        ...selectedTracksData.map(track => 
                            headers.map(header => {
                                const value = track[header] || '';
                                return value.includes(',') ? `"${value}"` : value;
                            }).join(',')
                        )
                    ].join('\n');

                    // Descargar archivo
                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `selected_tracks_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);

                    this.showToast(`${selectedTracksData.length} canciones descargadas exitosamente`, 'success');

                } catch (error) {
                    console.error('Error downloading selected tracks:', error);
                    this.showToast('Error al descargar las canciones seleccionadas', 'error');
                }
            }

            showLoading() {
                document.getElementById('loadingState').style.display = 'block';
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('tableContainer').style.display = 'none';
            }

            showEmptyState() {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('tableContainer').style.display = 'none';
                
                // Actualizar mensaje seg√∫n la fuente
                const emptyState = document.getElementById('emptyState');
                if (this.currentSource === 'uploaded') {
                    emptyState.innerHTML = `
                        <div class="icon">üìÅ</div>
                        <h3>No hay archivo cargado</h3>
                        <p>Sube un archivo CSV desde tu ordenador para comenzar a visualizar y seleccionar tracks</p>
                    `;
                } else {
                    emptyState.innerHTML = `
                        <div class="icon">üíæ</div>
                        <h3>No hay archivo seleccionado</h3>
                        <p>Selecciona un archivo CSV del servidor para comenzar a visualizar y seleccionar tracks</p>
                    `;
                }
                
                this.clearSelection();
            }

            showTable() {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('tableContainer').style.display = 'block';
            }

            showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = `toast ${type}`;
                
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.className = 'toast', 300);
                }, 3000);
            }

            // Funciones del reproductor de m√∫sica integrado
            async playTrack(title, artist) {
                this.currentPlayingTrack = { title, artist };
                this.showMusicPlayer(title, artist);
                
                try {
                    // Buscar la canci√≥n en YouTube usando la API (simulado)
                    await this.searchAndLoadYouTubeVideo(title, artist);
                } catch (error) {
                    console.error('Error loading track:', error);
                    this.showToast('Error cargando la canci√≥n', 'error');
                }
            }

            showMusicPlayer(title, artist) {
                const overlay = document.getElementById('musicPlayerOverlay');
                const titleElements = [
                    document.getElementById('playerTrackTitle'),
                    document.getElementById('playerTrackTitleBottom')
                ];
                const artistElements = [
                    document.getElementById('playerTrackArtist'),
                    document.getElementById('playerTrackArtistBottom')
                ];

                // Actualizar informaci√≥n del track
                titleElements.forEach(el => el.textContent = title);
                artistElements.forEach(el => el.textContent = artist);

                // Mostrar loading y ocultar iframe
                document.getElementById('musicLoading').style.display = 'block';
                document.getElementById('musicPlayerIframe').style.display = 'none';

                // Mostrar overlay
                overlay.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }

            async searchAndLoadYouTubeVideo(title, artist) {
                const searchQuery = `${artist} ${title}`.trim().replace(/[^\w\s]/gi, ' ');
                const iframe = document.getElementById('musicPlayerIframe');
                const loading = document.getElementById('musicLoading');

                try {
                    // Mostrar mensaje de b√∫squeda
                    loading.innerHTML = `
                        <div class="spinner"></div>
                        <p>Buscando "${title}" de ${artist}...</p>
                    `;

                    // M√©todo 1: Intentar con backend API
                    let videoId = await this.searchViaBackendAPI(searchQuery);
                    
                    // M√©todo 2: Fallback a b√∫squeda local si el backend falla
                    if (!videoId) {
                        videoId = await this.findYouTubeVideoId(searchQuery);
                    }
                    
                    if (videoId) {
                        const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&showinfo=0&modestbranding=1`;
                        
                        iframe.onload = () => {
                            loading.style.display = 'none';
                            iframe.style.display = 'block';
                            this.showToast(`Reproduciendo: ${title} - ${artist}`, 'success');
                        };

                        iframe.onerror = () => {
                            this.handleVideoError(searchQuery);
                        };

                        iframe.src = embedUrl;
                        
                        // Fallback timeout
                        setTimeout(() => {
                            if (loading.style.display !== 'none') {
                                loading.style.display = 'none';
                                iframe.style.display = 'block';
                            }
                        }, 3000);
                    } else {
                        throw new Error('No se encontr√≥ el video');
                    }

                } catch (error) {
                    console.error('Error loading video:', error);
                    this.handleVideoError(searchQuery);
                }
            }

            async searchViaBackendAPI(searchQuery) {
                try {
                    const response = await fetch('/api/youtube/search', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            query: searchQuery,
                            maxResults: 3
                        })
                    });
                    
                    if (!response.ok) {
                        console.log('API backend no disponible, usando m√©todo local');
                        return null;
                    }
                    
                    const data = await response.json();
                    
                    if (data.success && data.results && data.results.length > 0) {
                        console.log('Usando resultado de API backend:', data.results[0]);
                        return data.results[0].videoId;
                    }
                    
                    return null;

                } catch (error) {
                    console.log('Backend API no disponible:', error.message);
                    return null;
                }
            }

            async findYouTubeVideoId(searchQuery) {
                try {
                    // Intentar buscar usando YouTube Search API (simulado)
                    // En una implementaci√≥n real, esto har√≠a una llamada a tu backend
                    
                    // M√©todo 1: Intentar con una base de datos de tracks populares
                    const videoId = await this.searchInMusicDatabase(searchQuery);
                    if (videoId) return videoId;

                    // M√©todo 2: Usar scraping simulado (en producci√≥n ser√≠a un endpoint de tu backend)
                    const scrapedId = await this.simulateYouTubeSearch(searchQuery);
                    if (scrapedId) return scrapedId;
                    
                    // M√©todo 3: Fallback a videos gen√©ricos por g√©nero
                    return this.getFallbackVideo(searchQuery);

                } catch (error) {
                    console.error('Error finding video:', error);
                    return this.getFallbackVideo(searchQuery);
                }
            }

            async searchInMusicDatabase(searchQuery) {
                // Base de datos simulada de tracks populares con sus IDs de YouTube
                const trackDatabase = {
                    // House Music
                    'martin garrix animals': 'gCYcHz2k5x0',
                    'avicii levels': '_ovdm2yX4MA',
                    'deadmau5 strobe': 'tKi9Z-f6qX4',
                    'eric prydz call on me': 'qetW6R9Jxs4',
                    'house music': 'kJQP7kiw5Fk',
                    
                    // Techno
                    'carl cox': '_WamkRSDeD8',
                    'adam beyer': '6p0DAz_30qQ',
                    'techno music': '_WamkRSDeD8',
                    
                    // Trance
                    'armin van buuren': 'PLFVGzyxDyg',
                    'above beyond': '4YFYWsH6BBQ',
                    'trance music': 'PLFVGzyxDyg',
                    
                    // Progressive
                    'progressive house': '6p0DAz_30qQ',
                    'melodic techno': '1zi7bqRfdC4',
                    
                    // General Electronic
                    'electronic music': 'kJQP7kiw5Fk',
                    'edm': 'gCYcHz2k5x0',
                    'dance music': '_ovdm2yX4MA'
                };

                const query = searchQuery.toLowerCase().replace(/[^\w\s]/g, ' ').trim();
                
                // Buscar coincidencias exactas primero
                if (trackDatabase[query]) {
                    return trackDatabase[query];
                }
                
                // Buscar coincidencias parciales
                for (const [key, videoId] of Object.entries(trackDatabase)) {
                    if (query.includes(key) || key.includes(query)) {
                        return videoId;
                    }
                }
                
                return null;
            }

            async simulateYouTubeSearch(searchQuery) {
                try {
                    // Simular una b√∫squeda de YouTube API
                    // En producci√≥n, esto ser√≠a una llamada a tu backend que use YouTube API
                    
                    const genres = {
                        house: ['kJQP7kiw5Fk', 'NLfnJMsVvzU', '8gXcEUa2lEY'],
                        techno: ['_WamkRSDeD8', '6p0DAz_30qQ', 'hF_2aQhXcCo'],
                        trance: ['PLFVGzyxDyg', '4YFYWsH6BBQ', 'ZJ4D8DYPfSI'],
                        progressive: ['6p0DAz_30qQ', '1zi7bqRfdC4', 'yQgLl-cP-ko'],
                        ambient: ['1zi7bqRfdC4', 'cjO2-fYw8vk', 'mahoSVZhpUo']
                    };

                    const query = searchQuery.toLowerCase();
                    
                    // Determinar g√©nero basado en palabras clave
                    for (const [genre, videoIds] of Object.entries(genres)) {
                        if (query.includes(genre)) {
                            return videoIds[Math.floor(Math.random() * videoIds.length)];
                        }
                    }
                    
                    // Si no se encuentra g√©nero espec√≠fico, usar videos populares aleatorios
                    const allVideos = Object.values(genres).flat();
                    return allVideos[Math.floor(Math.random() * allVideos.length)];

                } catch (error) {
                    return null;
                }
            }

            getFallbackVideo(searchQuery) {
                // Videos de fallback seguros que funcionan
                const fallbackVideos = [
                    'kJQP7kiw5Fk', // Deep House mix
                    '_WamkRSDeD8', // Techno mix  
                    'PLFVGzyxDyg', // Trance mix
                    '6p0DAz_30qQ', // Progressive mix
                    '1zi7bqRfdC4'  // Ambient mix
                ];
                
                const query = searchQuery.toLowerCase();
                
                // Seleccionar video basado en palabras clave
                if (query.includes('house')) return fallbackVideos[0];
                if (query.includes('techno')) return fallbackVideos[1];
                if (query.includes('trance')) return fallbackVideos[2];
                if (query.includes('progressive')) return fallbackVideos[3];
                if (query.includes('ambient') || query.includes('chill')) return fallbackVideos[4];
                
                // Video aleatorio como √∫ltimo recurso
                return fallbackVideos[Math.floor(Math.random() * fallbackVideos.length)];
            }

            handleVideoError(searchQuery) {
                const loading = document.getElementById('musicLoading');
                const iframe = document.getElementById('musicPlayerIframe');
                
                loading.style.display = 'none';
                iframe.style.display = 'none';
                
                this.showToast('No se pudo cargar el video. Abriendo YouTube...', 'error');
                
                // Abrir b√∫squeda en YouTube como fallback
                setTimeout(() => {
                    const searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(searchQuery)}`;
                    window.open(searchUrl, '_blank');
                    this.closeMusicPlayer();
                }, 1500);
            }

            searchYouTube() {
                if (this.currentPlayingTrack) {
                    const { title, artist } = this.currentPlayingTrack;
                    const searchQuery = encodeURIComponent(`${artist} ${title}`);
                    window.open(`https://www.youtube.com/results?search_query=${searchQuery}`, '_blank');
                }
            }

            closeMusicPlayer() {
                const overlay = document.getElementById('musicPlayerOverlay');
                const iframe = document.getElementById('musicPlayerIframe');
                
                // Ocultar overlay
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                // Parar reproducci√≥n
                iframe.src = '';
                
                // Resetear estados
                document.getElementById('musicLoading').style.display = 'block';
                iframe.style.display = 'none';
                
                this.currentPlayingTrack = null;
                this.showToast('Reproductor cerrado', 'success');
            }
        }

        // Crear elementos flotantes - Mismo efecto que index.html
        function createFloatingElements() {
            const container = document.getElementById('floatingElements');
            const elementCount = 15;

            for (let i = 0; i < elementCount; i++) {
                const dot = document.createElement('div');
                dot.className = 'floating-dot';
                
                dot.style.left = Math.random() * 100 + '%';
                dot.style.animationDelay = Math.random() * 10 + 's';
                dot.style.animationDuration = (Math.random() * 5 + 8) + 's';
                
                container.appendChild(dot);
            }
        }

        // Efecto parallax en scroll
        let ticking = false;
        
        function updateScrollEffects() {
            const scrolled = window.pageYOffset;
            const rate = scrolled * -0.2;
            
            const floatingElements = document.querySelector('.floating-elements');
            if (floatingElements) {
                floatingElements.style.transform = `translate3d(0, ${rate}px, 0)`;
            }
            
            ticking = false;
        }
        
        window.addEventListener('scroll', () => {
            if (!ticking) {
                requestAnimationFrame(updateScrollEffects);
                ticking = true;
            }
        });

        // Inicializar la aplicaci√≥n
        const trackVisualizer = new TrackVisualizer();
        
        // Crear elementos flotantes al cargar
        createFloatingElements();
    </script>
</body>
</html>
